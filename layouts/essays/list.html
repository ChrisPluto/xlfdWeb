{{ define "main" }}

{{ $dailyPages := where .Site.RegularPages "Section" "daily" }}
{{ $insightsPages := where .Site.RegularPages "Section" "insights" }}
{{ $thoughtsPages := where .Site.RegularPages "Section" "thoughts" }}
{{ $techPages := where .Site.RegularPages "Section" "tech" }}
{{ $essaysPages := where .Site.RegularPages "Section" "essays" }}

<style>
.with-sidebar { display: flex; gap: 0; max-width: 1400px; margin: 0 auto; }
.sidebar-nav { width: 300px; flex: 0 0 300px; position: sticky; top: 64px; height: calc(100vh - 64px); overflow-y: auto; border-right: 1px solid #e5e7eb; background: #fafafa; padding: 16px 0; }
.sidebar-group { margin-bottom: 8px; }
.sidebar-group-header { display: flex; align-items: center; gap: 10px; padding: 12px 16px; font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; color: #6b7280; }
.sidebar-links { padding: 0 8px; }
.sidebar-parent { display: flex; align-items: center; padding: 10px 12px; border-radius: 8px; font-size: 14px; color: #4b5563; cursor: pointer; text-decoration: none; }
.sidebar-parent:hover { background: #f3f4f6; color: #1a1dc3; }
.sidebar-chevron { font-size: 11px; color: #9ca3af; transition: transform 0.2s; margin-left: auto; }
.sidebar-parent.open > .sidebar-chevron { transform: rotate(90deg); }
.sidebar-children { display: none; padding-left: 20px; margin-top: 4px; }
.sidebar-parent.open + .sidebar-children { display: block; }
.sidebar-year { display: flex; align-items: center; padding: 8px 10px; border-radius: 6px; font-size: 14px; color: #4b5563; cursor: pointer; }
.sidebar-year.open > .sidebar-chevron { transform: rotate(90deg); }
.sidebar-months { display: none; padding-left: 16px; }
.sidebar-year.open + .sidebar-months { display: block; }
.sidebar-month { padding: 6px 10px; font-size: 13px; color: #6b7280; border-radius: 4px; cursor: pointer; display: block; text-decoration: none; }
.sidebar-month:hover, .sidebar-month.active { background: #f3f4f6; color: #1a1dc3; }
.sidebar-article { display: block; padding: 8px 10px; font-size: 13px; color: #6b7280; border-radius: 4px; text-decoration: none; cursor: pointer; }
.sidebar-article:hover, .sidebar-article.active { background: #f3f4f6; color: #1a1dc3; }
.main-content { flex: 1; min-width: 0; padding: 32px 40px; overflow-y: auto; max-height: calc(100vh - 64px); }
.article-header { margin-bottom: 24px; padding-bottom: 16px; border-bottom: 1px solid #e5e7eb; }
.article-title { font-size: 24px; font-weight: 700; margin-bottom: 8px; }
.article-meta { font-size: 13px; color: #9ca3af; }
.article-content { font-size: 15px; line-height: 1.8; }
.loading { text-align: center; padding: 40px; color: #9ca3af; }
@media (max-width: 900px) { .with-sidebar { flex-direction: column; } .sidebar-nav { width: 100%; border-right: none; border-bottom: 1px solid #e5e7eb; } }
</style>

<div class="with-sidebar">
  <aside class="sidebar-nav">
    <!-- æŠ•èµ„è®°å½• -->
    <div class="sidebar-group">
      <div class="sidebar-group-header">ğŸ“Š æŠ•èµ„è®°å½•</div>
      <div class="sidebar-links">
        <div class="sidebar-parent open" onclick="this.classList.toggle('open')">
          <span>ğŸ“ˆ</span>
          <span style="margin-left:8px">åªä¹°ä¸å–å®šæŠ•ä¸‰åå¹´</span>
          <i class="fas fa-chevron-right sidebar-chevron"></i>
        </div>
        <div class="sidebar-children">
          {{ range $yg := (sort ($dailyPages.GroupByDate "2006") "Key" "desc") }}
            <div class="sidebar-year" onclick="event.stopPropagation(); this.classList.toggle('open')">
              {{ $yg.Key }} å¹´
              <i class="fas fa-chevron-right sidebar-chevron" style="font-size:10px;margin-left:auto;"></i>
            </div>
            <div class="sidebar-months">
              {{ range $mg := (sort ($yg.Pages.GroupByDate "2006-01") "Key" "desc") }}
                {{ $ym := $mg.Key }}
                {{ $mn := (time (printf "%s-01" $ym)).Format "1" }}
                <a href="/mydca/?month={{ $ym }}" class="sidebar-month">{{ $mn }}æœˆ</a>
              {{ end }}
            </div>
          {{ end }}
        </div>
      </div>
    </div>
    
    <!-- æŠ•èµ„å­¦ä¹  -->
    <div class="sidebar-group">
      <div class="sidebar-group-header">ğŸ’¡ æŠ•èµ„å­¦ä¹ </div>
      <div class="sidebar-links">
        <a href="/mydca/insights/" class="sidebar-parent">
          <span>ğŸ“š</span>
          <span style="margin-left:8px">æ•´ç†ä¸æ€è€ƒ</span>
        </a>
      </div>
    </div>
    
    <!-- æŠ•èµ„æ™ºæ…§ -->
    <div class="sidebar-group">
      <div class="sidebar-group-header">ğŸ’­ æŠ•èµ„æ™ºæ…§</div>
      <div class="sidebar-links">
        <a href="/mydca/thoughts/" class="sidebar-parent">
          <span>ğŸ’¡</span>
          <span style="margin-left:8px">æŠ•èµ„ç­–ç•¥ä¸å“²æ€</span>
        </a>
      </div>
    </div>
    
    <!-- æŠ€æœ¯æ ˆ -->
    <div class="sidebar-group">
      <div class="sidebar-group-header">âš¡ æŠ€æœ¯æ ˆ</div>
      <div class="sidebar-links">
        <a href="/mydca/tech/" class="sidebar-parent">
          <span>ğŸ’»</span>
          <span style="margin-left:8px">æŠ€æœ¯æ´è§</span>
        </a>
      </div>
    </div>
    
    <!-- æ‚æ–‡éšç¬” -->
    <div class="sidebar-group">
      <div class="sidebar-group-header">ğŸ“ æ‚æ–‡éšç¬”</div>
      <div class="sidebar-links">
        <a href="/mydca/essays/" class="sidebar-parent">
          <span>ğŸ“</span>
          <span style="margin-left:8px">æ‚æ–‡éšç¬”</span>
        </a>
      </div>
    </div>
  </aside>
  
  <main class="main-content" id="main-content">
    <div class="loading">ç‚¹å‡»å·¦ä¾§æ–‡ç« æŸ¥çœ‹å†…å®¹</div>
  </main>
</div>

<script>
document.querySelectorAll('.sidebar-article').forEach(el => {
  el.addEventListener('click', function() {
    const url = this.getAttribute('data-url');
    if (!url) return;
    
    const contentArea = document.getElementById('main-content');
    
    document.querySelectorAll('.sidebar-article').forEach(a => a.classList.remove('active'));
    this.classList.add('active');
    
    contentArea.innerHTML = '<div class="loading">åŠ è½½ä¸­...</div>';
    
    fetch(url)
      .then(res => res.text())
      .then(html => {
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        const articleContent = doc.querySelector('.main-content');
        
        if (articleContent) {
          contentArea.innerHTML = articleContent.innerHTML;
        } else {
          contentArea.innerHTML = '<div class="loading">åŠ è½½å¤±è´¥</div>';
        }
      })
      .catch(err => {
        contentArea.innerHTML = '<div class="loading">åŠ è½½å¤±è´¥</div>';
      });
  });
});
</script>

{{ end }}
